name: Flutter Setup
description: A Flutter environment for use with GitHub Actions
author: "Lumis Labs <https://github.com/lumis-labs>"

branding:
  color: blue
  icon: feather

inputs:
  channel:
    description: "The Flutter channel to use (e.g. stable, beta, dev)"
    required: false
  version:
    description: "The Flutter version to use (e.g. 3.24.1)"
    required: false
  os:
    description: "The operating system to use (e.g. windows, linux, macos)"
    required: false
    default: linux
  architecture:
    description: "The architecture to use (e.g. arm64, x64)"
    required: false
    default: x64

runs:
  using: composite
  steps:
    - name: Download flutter URI tool
      run: |
        URI="https://github.com/lumis-labs/flutter-setup/releases/download/v1.0.0/flutter-setup-$OS-$ARCHITECTURE"
        curl -fL $URI -o $GITHUB_ACTION_PATH/flutter_setup
        chmod +x $GITHUB_ACTION_PATH/flutter_setup
      shell: bash
      env:
        OS: ${{ inputs.os }}
        ARCHITECTURE: ${{ inputs.architecture }}
        GITHUB_ACTION_PATH: ${{ github.action_path }}

    - name: Run flutter URI tool
      run: |
        FLUTTER_URI=$($GITHUB_ACTION_PATH/flutter_setup \
           ${{ inputs.os }} \
           ${{ inputs.architecture }} \
           ${{ inputs.channel }} \
           ${{ inputs.version }})
        echo "FLUTTER_URI=$FLUTTER_URI" >> $GITHUB_ENV
      shell: bash
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}

    - name: Download Flutter SDK
      if: startsWith(matrix.os, 'ubuntu')
      run: |
        curl -fL $FLUTTER_URI -o $GITHUB_ACTION_PATH/flutter.tar.xz
        tar -xJf $GITHUB_ACTION_PATH/flutter.tar.xz
      shell: bash
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}

    - name: Download Flutter SDK
      if: startsWith(matrix.os, 'windows') || startsWith(matrix.os, 'macos')
      run: |
        curl -fL $FLUTTER_URI -o $GITHUB_ACTION_PATH/flutter.zip
        unzip $GITHUB_ACTION_PATH/flutter.zip
      shell: bash
      env:
        GITHUB_ACTION_PATH: ${{ github.action_path }}

    - name: Add Flutter to PATH
      run: |
        echo "FLUTTER_ROOT=$GITHUB_ACTION_PATH/flutter" >> $GITHUB_ENV
        echo "PATH=$GITHUB_ACTION_PATH/flutter/bin:$PATH" >> $GITHUB_ENV
      shell: bash
